#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo ""
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘                  ğŸ” PRE-COMMIT CHECKS                         â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# 1. Format code with Prettier
echo "ğŸ“ Step 1/3: Formatting code with Prettier..."
npx prettier --write "src/**/*.ts" 2>/dev/null
if [ $? -ne 0 ]; then
  echo "âŒ Prettier formatting failed!"
  exit 1
fi
echo "âœ… Code formatted successfully"
echo ""

# 2. Lint code with ESLint
echo "ğŸ” Step 2/3: Linting code with ESLint..."
npm run lint
if [ $? -ne 0 ]; then
  echo "âŒ ESLint check failed!"
  exit 1
fi
echo "âœ… Linting passed"
echo ""

# 3. Run tests with Vitest
echo "ğŸ§ª Step 3/3: Running tests with Vitest..."
npm test
if [ $? -ne 0 ]; then
  echo "âŒ Tests failed!"
  exit 1
fi
echo "âœ… All tests passed"
echo ""

# Stage formatted files
echo "ğŸ“¦ Staging formatted files..."
git add -u
echo ""

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘              âœ… ALL CHECKS PASSED - READY TO COMMIT!          â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
