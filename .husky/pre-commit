#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo ""
echo "╔════════════════════════════════════════════════════════════════╗"
echo "║                  🔍 PRE-COMMIT CHECKS                         ║"
echo "╚════════════════════════════════════════════════════════════════╝"
echo ""

# 1. Format code with Prettier
echo "📝 Step 1/3: Formatting code with Prettier..."
npx prettier --write "src/**/*.ts" 2>/dev/null
if [ $? -ne 0 ]; then
  echo "❌ Prettier formatting failed!"
  exit 1
fi
echo "✅ Code formatted successfully"
echo ""

# 2. Lint code with ESLint
echo "🔎 Step 2/3: Linting code with ESLint..."
npm run lint
if [ $? -ne 0 ]; then
  echo "❌ ESLint check failed!"
  exit 1
fi
echo "✅ Linting passed"
echo ""

# 3. Run tests with Vitest
echo "🧪 Step 3/3: Running tests with Vitest..."
npm test
if [ $? -ne 0 ]; then
  echo "❌ Tests failed!"
  exit 1
fi
echo "✅ All tests passed"
echo ""

# Stage formatted files
echo "📦 Staging formatted files..."
git add -u
echo ""

echo "╔════════════════════════════════════════════════════════════════╗"
echo "║              ✅ ALL CHECKS PASSED - READY TO COMMIT!          ║"
echo "╚════════════════════════════════════════════════════════════════╝"
echo ""
